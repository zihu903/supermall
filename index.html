<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>网络网页</title>
    <style type="text/css">
      .btn {
        display: block;
        margin: 20px auto;
        padding: 5px;
        background-color: #007aff;
        border: 0;
        color: #ffffff;
        height: 40px;
        width: 200px;
        text-align: center;
      }

      .btn-red {
        background-color: #dd524d;
      }

      .desc {
        padding: 10px;
        color: #999999;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <!-- 按钮区域 -->
    <div class="btn-list">
      <!-- 修改点：添加了 data-action 属性用于标识 -->
      <button class="btn btn-red" type="button" id="postMessage" data-action="sendNow">立即发送消息</button>
    </div>

    <p class="desc">点击上方按钮，网页将立即向宿主应用发送消息。</p>

    <script type="text/javascript">
      var userAgent = navigator.userAgent;
      if (/miniProgram/i.test(userAgent) && /micromessenger/i.test(userAgent)) {
        document.write('<script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"><\/script>');
      }
      // 如果不是头条小程序，则显示按钮区域（保持原逻辑）
      if (!/toutiaomicroapp/i.test(userAgent)) {
        document.querySelector('.btn-list').style.visibility = 'visible';
      }
    </script>
    
    <!-- uni 的 SDK -->
    <script type="text/javascript" src="uni.webview.1.5.6.js"></script>
    <script type="text/javascript">
      // 待触发 `UniAppJSBridgeReady` 事件后，即可调用 uni 的 API。
      document.addEventListener('UniAppJSBridgeReady', function() {
        
        // 初始化环境检测（可选）
        uni.getEnv(function(res) {
            console.log('当前环境：' + JSON.stringify(res));
        });

        // 为按钮绑定点击事件
        document.getElementById('postMessage').addEventListener('click', function() {
          console.log('按钮被点击，准备发送消息...');
          
          // 执行发送逻辑
          uni.postMessage({
            data: {
              action: 'message',
              timestamp: new Date().getTime(), // 添加时间戳证明是实时发送
              message: 'Hello from Web Page!'
            }
          });
          
          console.log('消息已发出');
        });
      });
    </script>
  </body>
</html>
