<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>点击发送消息</title>
    <style type="text/css">
      .btn {
        display: block;
        margin: 20px auto;
        padding: 5px;
        background-color: #007aff;
        border: 0;
        color: #ffffff;
        height: 40px;
        width: 200px;
        text-align: center;
      }

      .btn-red {
        background-color: #dd524d;
      }

      .desc {
        padding: 10px;
        color: #999999;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <!-- 按钮区域 -->
    <div class="btn-list">
      <!-- 修改点：添加了 data-action 属性用于标识 -->
      <button class="btn btn-red" type="button" id="postMessage" data-action="sendNow">立即发送消息</button>
    </div>

    <p class="desc">点击上方按钮，网页将立即向宿主应用发送消息。</p>

    <script type="text/javascript">
  document.addEventListener('UniAppJSBridgeReady', function() {
    
    // 1. 初始化环境
    uni.getEnv(function(res) {
      console.log('当前环境：' + JSON.stringify(res));
    });

    // 2. 【新增】在网页端监听一个全局事件（虽然通常在小程序监听，但这里为了演示原理）
    // 实际上，我们只需要确保 BridgeReady 后，就可以通过 emit 发送数据

    document.getElementById('postMessage').addEventListener('click', function() {
      console.log('按钮被点击，准备发送消息...');

      // 3. 【修改】不再使用 postMessage，改用 emit 触发全局事件
      // 注意：这里的数据会直接传递给小程序
      uni.$emit('webData', { 
        action: 'message',
        timestamp: new Date().getTime(),
        message: 'Hello from Web Page!'
      });

      console.log('消息已发出');
    });
  });
</script>
  </body>
</html>
