<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>【网页】uni.$emit</title>
    <style type="text/css">
      .btn {
        display: block;
        margin: 20px auto;
        padding: 5px;
        background-color: #007aff;
        border: 0;
        color: #ffffff;
        height: 40px;
        width: 200px;
        text-align: center;
      }

      .btn-red {
        background-color: #dd524d;
      }

      .desc {
        padding: 10px;
        color: #999999;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <!-- 按钮区域 -->
    <div class="btn-list">
      <!-- 修改点：添加了 data-action 属性用于标识 -->
      <button class="btn btn-red" type="button" id="postMessage" data-action="sendNow">立即发送uni.$emit消息</button>
    </div>

    <p class="desc">点击上方按钮，网页将立即向宿主应用发送消息。</p>

    <script type="text/javascript">
      var userAgent = navigator.userAgent;
      if (/miniProgram/i.test(userAgent) && /micromessenger/i.test(userAgent)) {
        document.write('<script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js"><\/script>');
      }
      // 如果不是头条小程序，则显示按钮区域（保持原逻辑）
      if (!/toutiaomicroapp/i.test(userAgent)) {
        document.querySelector('.btn-list').style.visibility = 'visible';
      }
    </script>
    
    <!-- uni 的 SDK -->
    <script type="text/javascript" src="uni.webview.1.5.6.js"></script>
    <script type="text/javascript">
  // 等待 UniApp JSBridge 加载完成
  document.addEventListener('UniAppJSBridgeReady', function() {
    console.log('【网页】JSBridge 已就绪，准备绑定按钮...');

    // 获取按钮并绑定点击事件
    const btn = document.getElementById('postMessage');
    if (btn) {
      btn.addEventListener('click', function() {
        console.log('【网页】按钮被点击，准备发送 uni.$emit...');

        // 核心代码：触发全局事件
        try {
          // 发送一个名为 'webData' 的事件，携带数据
          uni.$emit('webData', { 
            action: 'jump', 
            value: '网页发送的数据' 
          });
          console.log('【网页】uni.$emit 发送成功！');
        } catch (e) {
          console.error('【网页】uni.$emit 发送出错:', e);
        }
      });
    } else {
      console.error('【网页】找不到按钮元素');
    }
  });
</script>
  </body>
</html>
